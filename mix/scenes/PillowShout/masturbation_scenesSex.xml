<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE scenes [
	<!ELEMENT scenes (scene+)>
	<!ELEMENT scene (filter*,(p|script)*,action*)>
	<!ELEMENT filter EMPTY>
	<!ELEMENT script (#PCDATA)>
	<!ELEMENT action EMPTY>
	<!ATTLIST scene
		id ID #REQUIRED
		name CDATA #REQUIRED
		list CDATA #IMPLIED
		priority CDATA #IMPLIED
	>
	<!ATTLIST filter
		target (top|bottom) #REQUIRED
		type CDATA #REQUIRED
		name CDATA #IMPLIED
		value CDATA #IMPLIED
	>
	<!ATTLIST script type CDATA #FIXED "text/javascript">
	<!ATTLIST action
		name CDATA #REQUIRED
		listas CDATA #IMPLIED
	>

	<!-- P can now have not only #PCDATA, but also IF and ELSE, in any combination. -->
	<!ELEMENT p (#PCDATA|if|else)*>
	<!ELEMENT if (#PCDATA|if|else)*>
	<!ELEMENT else (#PCDATA|if|else)*>
	<!-- Same as FILTER above. -->
	<!ATTLIST if
		target (top|bottom) #REQUIRED
		type CDATA #REQUIRED
		name CDATA #IMPLIED
		value CDATA #IMPLIED
	>
]>
<scenes>
	<!-- Written by PillowShout -->
	<scene id="PillowMasturbationStart" name="(masturbate)">
		<script type="text/javascript">
			<![CDATA[
				var stim = top.GetToken("stimulation").Value;
				if (stim < 50)
				{
					print("Even though you're not feeling all that bothered at the moment, you decide that now is as good a time as any to blow off some steam. One brief search later and you've found someplace private enough for you to take care of business.");
				}
				else if (stim < 80)
				{
					print("You've been dealing with your building arousal for some time now, and you decide that you've earned the right to some release. You quickly look around for a spot away from prying eyes and manage to find one nearby.");
				}
				else
				{
					print("The ache in your loins has become unbearable, and you feel an urgent need to take care of it. After a short and frantic search, you manage to find somewhere secluded enough for you to deal with your problem.");
				}
			]]>
		</script>
		<action name="masturbate cont biped"/>
		<action name="masturbate cont centaur"/>
		<action name="masturbate cont quadruped"/>
		<action name="masturbate cont no legs"/>
	</scene>

	<scene id="PillowMasturbationContinueBiped" name="masturbate cont biped">
		<filter target="top" type="hasnot" name="quadruped"/>
		<filter target="top" type="hasnot" name="taur"/>
		<filter target="top" type="has" name="legs"/>
		<script type="text/javascript">
			<![CDATA[
				print("You find yourself a comfortable place to sit and lower yourself onto the ground. "); 
				
				if(top.HasItemInSlot("pants") && top.HasItemInSlot("underpants"))
				{
					print("Once you're seated, you remove your [t:equipment:pants] and [t:equipment:underpants] and leave them off to the side. With that out of the way, you ");
				}
				else if(top.HasItemInSlot("pants"))
				{
					var pronoun = "it";
					
					if(top.GetEquippedItemBySlot("pants").HasToken("plural"))
						pronoun = "them";
				
					print("Once you're seated, you take off your [t:equipment:pants:color] and leave " + pronoun + " off to the side. With that out of the way, you ");
				}
				else if (top.HasItemInSlot("underpants"))
				{
					var pronoun = "it";
					
					if(top.GetEquippedItemBySlot("underpants").HasToken("plural"))
						pronoun = "them";
				
					print("Once you're seated, you slide off your [t:equipment:underpants:color] and leave " + pronoun + " off to the side. With that out of the way, you ");
				}
				else
					print("Once you're seated, you ") 
					
				print("lean back on one hand and splay your legs while you run the other ");
				
				var breasts = top.Path("breastrow[0]");
				var size = 0;
				if(breasts.HasToken("size"))
					size = breasts.GetToken("size").Value;
				if(size > 0.1)
					print("over your [t:breasts] and ");
					
				print("down your stomach, towards your groin.\n\n");

				
				var g = top.GetGender();
				var stim = top.GetToken("stimulation").Value;
				if(g == "male")
				{
					print("Your [t:cocktype] [cockrand] twitches as you run your hand along its length, ");
					
					if(stim < 50)
					{
						print("and you can feel it hardening in your palm as you slowly stroke it. A few moments pass before you feel you're ready to begin, but once you do, you begin to pump in earnest.");
					}
					else if (stim < 80)
					{
						print("and you use the small dollop of precum on its tip to lubricate your palm as you move on to more vigorous caressing.");
					}
					else
					{
						print("which comes away sticky from your precum slicked tool. You waste no time in getting down to business and before long you're frantically stroking your prick.");
					}
					
					print(" \n\nYou continue to pump away at your [t:cocktype] [cockrand], and soon enough you can feel a pressure building in your loins. You speed up your strokes as feel yourself drawing closer to orgasm, and as you finally reach your climax, you feel ");
					
					if(stim < 50)
					{
						print("a pleasant warmth");
					}
					else if (stim < 80)
					{
						print("a great sense of relief");
					}
					else
					{
						print("an immense sense of relief");
					}
					
					print(" flood your body.");

					top.IncreaseSkill("penile masturbation");
				}
				else if(g == "female")
				{
					var vag = top.Path("vagina[0]");
					var wetness = 1;
					if(vag && vag.HasToken("wetness"))
						wetness = vag.GetToken("wetness").Value;
						
					var skin = top.Path("skin/type").Text;
					
					print("You run your hand over your ");
						
						if(skin == "scales")
							print("scaly");
						else if(skin == "skin")
							print("smooth");
						else if(skin == "fur")
							print("fur covered")
						else
							print("smooth")
							
						print(" labia ");
					
					if(stim < 50 && wetness < 2)
					{
						print("and spread your lips as you place a finger at the entrance of your cunny. You run your finger around the outside of your entrance and continue to massage it until it's wet enough that you can easily slide your finger inside. ");
						print("Drawing your finger out of your hole, you use your juices to lube up your [clitrand] and start rolling it under your fingers.");
					}
					else if (stim < 80 || wetness >= 2)
					{
						print("and find that your [pussyrand] is already wet with your juices. After dipping a finger inside of your slicked up [pussyrand], you take your now equally lubed up finger and begin to rub your fluids onto your [clitrand].");
					}
					else
					{
						print("and find that they along with the insides of your thighs ");
						if(skin == "fur")
							print("have become matted with your fluids. ");
						else
							print("are moist from your arousal. ");
						
						print("Using your fingers to gather some lube fresh from the source, you rub your fingers over your [clitrand] and sigh contentedly as your neglected [pussyrand] is finally given some attention.");
					}
					
					print(" \n\nYou continue to kneed at your [clitrand], and soon enough you can feel a pressure building in your loins. You rub your [clitrand] more vigorously as you feel yourself drawing closer to orgasm, and as you finally reach your climax, you feel ");
					
					if(stim < 50)
					{
						print("a pleasant warmth flow through you.");
					}
					else if (stim < 80)
					{
						print("a tingling heat flood your body.");
					}
					else
					{
						print("an immense sense of relief wash over you.");
					}
					
					top.IncreaseSkill("vaginal masturbation");
				}
				else if (g == "hermaphrodite")
				{
					print("And then you wanked... <placeholder text>");
					
					if(stim < 50)
					{
					
					}
					else if (stim < 80)
					{
					
					}
					else
					{
					
					}
					
					top.IncreaseSkill("penile masturbation");
					top.IncreaseSkill("vaginal masturbation");
				}
				else	// Neuter Characters
				{
					print("However, upon reaching your crotch, you remember that you have no genitals, and despite several minutes of fruitless rubbing, you eventually groan in frustration and give up on trying to pleasure yourself. <placeholder text>");
				}
			]]>
		</script>
		<action name="masturbation end"/>
	</scene>

	<scene id="PillowMasturbationContinueCentaur" name="masturbate cont centaur">
		<filter target="top" type="has" name="taur"/>
		<!-- KAWA: Removed the !noarms check, now that taur implies !noarms already. -->
		<script type="text/javascript">
			<![CDATA[
				// TODO Add clothing removal
				print("And then you wanked... <placeholder text>");
				
				// TODO Figure out how flexible centaurs are...
				
				//KAWA: mind the part about pants in the quadruped scene.
			]]>
		</script>
		<action name="masturbation end"/>
	</scene>

	<scene id="PillowMasturbationContinuePureQuadruped" name="masturbate cont quadruped">
		<filter target="top" type="has" name="quadruped"/>
		<script type="text/javascript">
			<![CDATA[
			
				print("You find yourself a decent looking spot and then drop down and roll onto your back. "); 
				/* KAWA: Quadrupeds, centaurs, slimes, and nagas can't wear pants. In fact, if you wear any and become a centaur or quadruped, you tear them.
				 * That is, they'll be replaced with tatteredshreds_SLOTNAME. If you grow a snaketail or slimeblob, you merely slip out and get to keep the pants.
				 * TLDR, These check will always be false.
				if(top.HasItemInSlot("pants") && top.HasItemInSlot("underpants"))
				{
					print("Once you've made yourself comfortable, you remove your [t:equipment:pants] and [t:equipment:underpants] and leave them off to the side. With that out of the way, you ");
				}
				else if(top.HasItemInSlot("pants"))
				{
					var pronoun = "it";
					
					if(top.GetEquippedItemBySlot("pants").HasToken("plural"))
						pronoun = "them";
				
					print("Once you've made yourself comfortable, you take off your [t:equipment:pants:color] and leave " + pronoun + " off to the side. With that out of the way, you ");
				}
				else if (top.HasItemInSlot("underpants"))
				{
					var pronoun = "it";
					
					if(top.GetEquippedItemBySlot("underpants").HasToken("plural"))
						pronoun = "them";
				
					print("Once you've made yourself comfortable, you slide off your [t:equipment:underpants:color] and leave " + pronoun + " off to the side. With that out of the way, you ");
				}
				else
				*/
					print("Once you've made yourself comfortable, you ") 
			
				print("spread your hind legs and reach a [t:foot] down over your stomach, towards your groin.\n\n");
				
				var g = top.GetGender();
				var stim = top.GetToken("stimulation").Value;
				if(g == "male")
				{
					if(stim < 50)
					{
						print("Seeing that your [t:cocktype] [cockrand] is still soft, you start by rolling your [cockrand] around with your [t:foot] before you start rubbing it with more force. Your [cockrand] steadily grows larger and stiffer under your ministrations, and in short order it's standing fully erect. Now that you're ready to go, you wrap both [t:feet] around your [cockrand] and start sliding them back and forth along your length.");
					}
					else if (stim < 80)
					{
						print("You run a [t:foot] over your hardening [t:cocktype] [cockrand] and groan a little as your stroking continues to exite you. In little time at all, your [cockrand] is standing at attention and even has a small bead of pre forming on the tip. You wipe the drop of precum away with your [t:foot], and after using it to lube up your shaft a bit, your wrap both [t:feet] around your [cockrand] and start stroking yourself.");
					}
					else
					{
						print("Your painfully erect [t:cocktype] [cockrand] bounces against your stomach as you start to rub your [t:foot] along it. Using the small stream of precum flowing from the tip of your [cockrand], you slather your lube over your [cockrand] until glistens from base to tip. You then wrap both [t:feet] around your slicked up [cockrand] and start vigorously stroking yourself.");
					}
					
					print("\n\nYou continue to awkwardly pump your [t:cocktype] [cockrand] with your [t:feet], and soon enough you can feel a pressure building in your loins. You speed up your strokes as you feel yourself drawing closer to orgasm, and as you finally reach your climax, you feel ");
					
					if(stim < 50)
					{
						print("a pleasant warmth");
					}
					else if (stim < 80)
					{
						print("a tingling heat");
					}
					else
					{
						print("an immense sense of relief");
					}
					
					print(" flood your body while your [cumrand] shoots onto your chest and stomach.");
					
					top.IncreaseSkill("penile masturbation");
				}
				else if(g == "female")
				{
					var vag = top.Path("vagina");
					var wetness = 1;
					if(vag && vag.HasToken("wetness"))
						wetness = vag.GetToken("wetness").Value;
						
					var skin = top.Path("skin/type").Text;
						
					print("You run your [t:foot] over your ");
						
					if(skin == "scales")
						print("scaly");
					else if(skin == "skin")
						print("smooth");
					else if(skin == "fur")
						print("fur covered")
					else
						print("smooth")
						
					print(" labia ");
				
					if(stim < 50 && wetness < 2)
					{
						print("and start to slowly but deeply massage your [pussyrand]. As you continue to rub your [pussyrand], find yourself growing more and more excited, and soon you can feel a trickle of moisture forming at the entrance of your [pussyrand]. Using your [t:foot] as best you can, you gather up the lube and start rolling it onto your [clitrand].");
					}
					else if (stim < 80)
					{
						print("and find that your [pussyrand] is already wet with your juices. After rubbing your [t:foot] into your [pussyrand], you take your now equally lubed up [t:foot] and begin to rub your fluids onto your [clitrand].");
					}
					else
					{
						print("and find it to be so wet that at soon as you try spreading your [pussyrand], you feel some of your juice leak out and trickle down over your [anusrand]. Using your [t:foot] to gather some lube fresh from the source, you rub your lube slicked [t:foot] over your [clitrand] and sigh contentedly as your neglected [pussyrand] is finally given some attention.");
					}
					
					print("\n\nYou continue to rub your [t:foot] into your [clitrand], and soon enough you can feel a pressure building in your loins. You rub your [clitrand] more vigorously as you feel yourself drawing closer to orgasm, and as you finally reach your climax, you feel ");
					
					if(stim < 50)
					{
						print("a pleasant warmth flow through you, leaving you feeling relaxed and content for a while afterwards.");
					}
					else if (stim < 80)
					{
						print("a tingling heat flood your body, leaving you feeling light and satisfied for a while afterwards.");
					}
					else
					{
						print("an immense sense of relief wash over you, leaving you feeling tired but happy.");
					}
					
					top.IncreaseSkill("vaginal masturbation");
				}
				else if (g == "hermaphrodite")
				{
					print("\n\nAnd then you wanked... *placeholder text*");
					
					top.IncreaseSkill("penile masturbation");
					top.IncreaseSkill("vaginal masturbation");
				}
				else
				{
					print("After several minutes of fruitless rubbing, you groan in frustration and give up on trying to pleasure yourself. *placeholder text*");
				}
				
			]]>
		</script>

		<action name="masturbation end"/>
	</scene>


	<scene id="PillowMasturbationContinueNoLegs" name="masturbate cont no legs">
		<!-- KAWA: Moved this below the centaur and quadruped scenes just to make sure it sorts out right. -->
		<filter target="top" type="hasnot" name="legs"/>
		<script type="text/javascript">
			<![CDATA[
				print("You find yourself a comfortable place to sit and ")

				if(top.HasToken("snaketail"))
					print("lower yourself onto the ground, coiling your tail around itself so that it supports you. Once you're seated, you ");
				else if (top.HasToken("slimeblob"))
					print("relax your gelatinous lower half into a soft cushion. Once you're seated, you ");
				
				
				var breasts = top.Path("breastrow[0]");
				var size = 0;
				if(breasts.HasToken("size"))
					size = breasts.GetToken("size").Value;
				var hasBreasts = !(size > 0.1);
				
				if(hasBreasts)
					print("cup of one of your [t:breasts] in one hand while the other finds its way to your groin.\n\n");
				else
					print("run both of your hands down your stomach, towards your groin.\n\n");

				
				var g = top.GetGender();
				var stim = top.GetToken("stimulation").Value;
				if(g == "male")
				{					
					if(stim < 50)
					{
						if(hasBreasts)
							print("Your [t:cocktype] [cockrand] jerks as you run a hand along its length, and you can feel it hardening in your palm as you slowly stroke it. Using your other hand, you start to kneed and roll your [t:breasts], and after a few moments of sensually working both parts of your body, you start pumping your [cockrand] in earnest.");
						else
							print("Your emerging [t:cocktype] [cockrand] jerks as you take hold of it near its base, and you feel it hardening between your fingers as you begin to slowly stroke it with your other hand. Once you feel that you're good and hard, you begin pumping your [cockrand] more vigorously.");
					}
					else if (stim < 80)
					{
						if(hasBreasts)
							print("You massage your [breastrand] beneath your palm, rolling your [t:nipple] between your fingers while you run your other hand over your [t:cocktype] [cockrand]. ");
						else
							print("Your turgid [t:cocktype] [cockrand] jerks as you take hold of it near its base, and you feel it pulsing between your fingers as you begin to slowly stroke it with your other hand. ");
							
						print("You use the small dollop of precum on its tip to lubricate your palm as you run your hand up and down its length a few times before you start stroking it more vigorously.");
					}
					else
					{
						if(hasBreasts)
							print("Your painfully erect [t:cocktype] [cockrand] twitches as you run a hand along its length, and a large drop of pre runs down from its tip as you start to stroke it. As you continue to kneed your [breastrand] and stroke yourself, you find yourself becoming even more aroused, and before long you're frantically pumping your [cockrand].");
						else
							print("You wrap both your hands around your precum slicked [t:cocktype] [cockrand] and sigh in delight as you start to move them together along your length. You continue to slide your hands up and down your shaft, your pace constantly increasing until you're frantically stroking your [cockrand].");
					}
					
					print("\n\nYou continue to pump away at your [t:cocktype] [cockrand], and soon enough you can feel a pressure building in your loins. ");
					
					if(hasBreasts)
						print("You drop your hand from your breast as you feel yourself coming closer to orgasm and focus entirely on stroking your [cockrand]. As you finally reach your climax, you feel ");
					else
						print("You speed up your strokes as you feel yourself drawing closer to orgasm, and as you finally reach your climax, you feel ");
					
					if(stim < 50)
					{
						print("a pleasant warmth");
					}
					else if (stim < 80)
					{
						print("a tingling heat");
					}
					else
					{
						print("an immense sense of relief");
					}
					
					print(" flood your body while your [cumrand] shoots out onto your stomach.");

					top.IncreaseSkill("penile masturbation");
				}
				else if(g == "female")
				{
					var vag = top.Path("vagina");
					var wetness = 1;
					if(vag && vag.HasToken("wetness"))
						wetness = vag.GetToken("wetness").Value;
					
					if(stim < 50 && wetness < 5)
					{
						if(hasBreasts)
							print("You moan quietly as you slowly run your hands over your breasts and slit, and after using your fingers to spread your lips, you place another finger at the opening of your [pussyrand]. You run your finger around the outside of your entrance and continue to massage it until it's wet enough that you can easily slide your finger inside. Drawing your finger out of your hole, you use your juices to lube up your [clitrand] and start rolling it under your fingers.");
						else
							print("You run your hands over your slit and spread your lips with one hand as you use the other to slowly slide a finger into your [pussyrand]. You continue to slowly push it in and draw it out until your [pussyrand] is wet enough that you're able to easily slip another finger inside. As you continue to finger yourself, you use your other hand to lube up your [clitrand] and start rolling it beneath your palm.");
					}
					else if (stim < 80)
					{
						if(hasBreasts)
							print("You massage your [breastrand] beneath your palm, rolling your [t:nipple] between your fingers while you run your other hand over your [pussyrand]. After dipping a finger inside of your slicked up [pussyrand], you take your now equally lubed up finger and begin to rub your fluids onto your [clitrand]. ");
						else
							print("You run your hands over your slit and find that your [pussyrand] is already wet with your juices. After dipping a finger inside of your slicked up [pussyrand], you take your now equally lubed up finger and begin to rub your fluids onto your [clitrand]. Using your other hand, you slide a pair of fingers inside of your well lubed [pussyrand] and start to slowly thrust them in and out.");
					}
					else
					{
						if(hasBreasts)
							print("With one hand already massaging your [breastrand], you run the other over your slit and find that it and even the area beneath it are slick with your arousal. Using your fingers to gather some lube fresh from the source, you rub your fingers over your [clitrand] and sigh contentedly as your neglected [pussyrand] is finally given some attention.");
						else
							print("You run your hands over your slit and find that it and even the area beneath it are slick with your arousal. Using your fingers to gather some lube fresh from the source, you rub your hand over your [clitrand] and sigh contentedly as your neglected [pussyrand] is finally given some attention. Then, using your other hand, you slip a pair of fingers inside of your aching [pussyrand] and start to quickly thrust them in and out.");
					}
					
					
					
					if(hasBreasts)
						print("\n\nYou continue to rub your [clitrand] and massage your [breastrand], and soon enough you can feel a pressure building in your loins. ");
					else
						print("\n\nYou continue to kneed at your [clitrand] and pump your fingers in and out of your [pussyrand], and soon enough you can feel a pressure building in your loins. ");
						
					print("Forgetting about everything else, you focus entirely on rubbing your [clitrand] more vigorously as you feel yourself drawing closer to orgasm. As you finally reach your climax, you feel ");
					
					if(stim < 50)
					{
						print("a pleasant warmth flow through you, leaving you feeling relaxed and content for a while afterwards.");
					}
					else if (stim < 80)
					{
						print("a tingling heat flood your body, leaving you feeling light and satisfied for a while afterwards.");
					}
					else
					{
						print("an immense sense of relief wash over you, leaving you feeling tired but happy.");
					}
					
					top.IncreaseSkill("vaginal masturbation");
				}
				else if (g == "hermaphrodite")
				{
					print("And then you wanked... *placeholder text*");
					
					if(stim < 50)
					{
					
					}
					else if (stim < 80)
					{
					
					}
					else
					{
					
					}
					
					top.IncreaseSkill("penile masturbation");
					top.IncreaseSkill("vaginal masturbation");
				}
				else	// Neuter Characters
				{
					print("However, upon reaching your crotch, you remember that you have no genitals, and despite several minutes of fruitless rubbing, you eventually groan in frustration and give up on trying to pleasure yourself. *placeholder text*");
				}
			]]>
		</script>
		<action name="masturbation end"/>
	</scene>

	<scene id="PillowAfterMasturbation" name="masturbation end">
		<script type="text/javascript">
			<![CDATA[
				print("You lay there for a while, breathing steadily as you wait for your body to recover. Once a few minutes have passed, you decide that you've rested enough");

				if(top.HasItemInSlot("pants") || top.HasItemInSlot("underpants"))
					print(", and put your clothes back on before getting up to leave.");
				else
				print(" and get up to leave.");
			]]>
		</script>

		<script type="text/javascript">
			top.GetToken("climax").Value = 0;
			top.GetToken("stimulation").Value = 10;
		</script>
	</scene>
</scenes>